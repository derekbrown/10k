{"ast":null,"code":"\"use strict\";\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.Video = exports.VideoRenderer = void 0;\n\nconst jsx_runtime_1 = require(\"react/jsx-runtime\");\n\nconst react_1 = require(\"react\");\n\nconst MediaLoader_1 = require(\"./MediaLoader\");\n\nconst RendererConfig_1 = require(\"./RendererConfig\");\n\nconst Image_1 = require(\"./Image\");\n\nconst useSyncRef_1 = require(\"../utils/useSyncRef\");\n\nconst useA11yIdPrefix_1 = require(\"../utils/useA11yIdPrefix\");\n\nexports.VideoRenderer = react_1.forwardRef((props, ref) => {\n  var _a, _b, _c, _d;\n\n  const {\n    getString,\n    getStyles,\n    request,\n    theme,\n    a11yIdPrefix\n  } = props;\n  const [isPlaying, setIsPlaying] = react_1.useState(true);\n  const [isMuted, setIsMuted] = react_1.useState(true);\n  const [isFullScreen, setIsFullScreen] = react_1.useState(false);\n  const video = react_1.useRef(null);\n  const controlAriaId = useA11yIdPrefix_1.useA11yIdPrefix(\"video-renderer\");\n  const uri = request.renderingContext === \"FULL\" ? ((_a = request.media.animation) === null || _a === void 0 ? void 0 : _a.uri) || ((_b = request.media.content) === null || _b === void 0 ? void 0 : _b.uri) : ((_c = request.media.content) === null || _c === void 0 ? void 0 : _c.uri) || ((_d = request.media.animation) === null || _d === void 0 ? void 0 : _d.uri);\n  const {\n    props: mediaProps,\n    loading,\n    error\n  } = MediaLoader_1.useMediaObjectProps({\n    uri,\n    request,\n    a11yIdPrefix,\n    getStyles,\n    preferredIPFSGateway: theme.preferredIPFSGateway\n  });\n  useSyncRef_1.useSyncRef(video, ref);\n  react_1.useEffect(() => {\n    const fullScreenCallback = () => {\n      setIsFullScreen(!!document.fullscreenElement);\n    };\n\n    document.addEventListener(\"fullscreenchange\", fullScreenCallback);\n    return () => {\n      document.removeEventListener(\"fullscreenchange\", fullScreenCallback);\n    };\n  }, []);\n  const togglePlay = react_1.useCallback(() => {\n    var _a;\n\n    if (!video.current) {\n      return;\n    }\n\n    if (video.current.paused) {\n      video.current.play();\n    } else {\n      (_a = video.current) === null || _a === void 0 ? void 0 : _a.pause();\n    }\n  }, [video]);\n  const openFullscreen = react_1.useCallback(() => {\n    const elem = video.current;\n\n    if (elem && elem.requestFullscreen) {\n      setIsMuted(false);\n      return elem.requestFullscreen();\n    } // Thank Apple for this one :(. Needed for iOS\n    // @ts-ignore\n\n\n    if (elem && elem.webkitSetPresentationMode) {\n      setIsMuted(false); // @ts-ignore\n\n      return elem.webkitSetPresentationMode(\"fullscreen\");\n    }\n\n    return;\n  }, [video]);\n  const onCanPlay = react_1.useCallback(() => {\n    var _a;\n\n    setIsPlaying(!((_a = video.current) === null || _a === void 0 ? void 0 : _a.paused));\n  }, []);\n  const toggleMute = react_1.useCallback(() => {\n    if (!video.current) {\n      return;\n    }\n\n    if (video.current.muted) {\n      setIsMuted(false);\n    } else {\n      setIsMuted(true);\n    }\n  }, [video]);\n  const playLoop = react_1.useCallback(() => {\n    if (!video.current) {\n      return;\n    }\n\n    video.current.currentTime = 0;\n  }, [video.current]);\n  const playingText = isPlaying ? getString(\"VIDEO_CONTROLS_PAUSE\") : getString(\"VIDEO_CONTROLS_PLAY\"); // Fallback to rendering an image if loading the video fails\n\n  if (error) {\n    return jsx_runtime_1.jsx(Image_1.ImageRenderer, Object.assign({}, props), void 0);\n  }\n\n  return jsx_runtime_1.jsxs(MediaLoader_1.MediaLoader, Object.assign({\n    getStyles: getStyles,\n    loading: loading,\n    error: error\n  }, {\n    children: [video.current && jsx_runtime_1.jsxs(\"div\", Object.assign({\n      \"aria-label\": getString(\"VIDEO_CONTROLS_LABEL\"),\n      id: controlAriaId,\n      tabIndex: \"0\",\n      // @ts-ignore Blur is kinda invalid but okay to be unsafe here.\n      onMouseOut: evt => evt.target.blur()\n    }, getStyles(\"mediaVideoControls\", undefined, {\n      isFullPage: request.renderingContext === \"FULL\"\n    }), {\n      children: [jsx_runtime_1.jsx(\"button\", Object.assign({}, getStyles(\"mediaFullscreenButton\"), {\n        \"aria-pressed\": isFullScreen ? true : false,\n        onClick: openFullscreen,\n        title: getString(\"VIDEO_CONTROLS_FULLSCREEN\")\n      }, {\n        children: getString(\"VIDEO_CONTROLS_FULLSCREEN\")\n      }), void 0), jsx_runtime_1.jsx(\"button\", Object.assign({}, getStyles(\"mediaPlayButton\", undefined, {\n        playing: isPlaying\n      }), {\n        \"aria-live\": \"polite\",\n        \"aria-pressed\": isPlaying ? false : true,\n        onClick: togglePlay,\n        title: playingText\n      }, {\n        children: playingText\n      }), void 0), jsx_runtime_1.jsx(\"button\", Object.assign({}, getStyles(\"mediaMuteButton\", undefined, {\n        muted: isMuted\n      }), {\n        onClick: toggleMute,\n        \"aria-pressed\": isMuted ? false : true\n      }, {\n        children: getString(\"VIDEO_CONTROLS_MUTE\")\n      }), void 0)]\n    }), void 0), jsx_runtime_1.jsx(\"video\", Object.assign({}, mediaProps, {\n      \"aria-controls\": controlAriaId,\n      autoPlay: true,\n      controls: isFullScreen,\n      loop: true,\n      muted: isMuted,\n      onCanPlayThrough: onCanPlay,\n      onEnded: playLoop,\n      onLoadedData: mediaProps.onLoad,\n      onPause: () => setIsPlaying(false),\n      onPlay: () => setIsPlaying(true),\n      playsInline: true,\n      preload: \"metadata\",\n      ref: video\n    }), void 0)]\n  }), void 0);\n});\nexports.Video = {\n  getRenderingPreference: request => {\n    var _a, _b, _c, _d;\n\n    if ((_b = (_a = request.media.animation) === null || _a === void 0 ? void 0 : _a.type) === null || _b === void 0 ? void 0 : _b.startsWith(\"video/\")) {\n      return RendererConfig_1.RenderingPreference.PRIORITY;\n    }\n\n    if ((_d = (_c = request.media.content) === null || _c === void 0 ? void 0 : _c.type) === null || _d === void 0 ? void 0 : _d.startsWith(\"video/\")) {\n      return RendererConfig_1.RenderingPreference.PRIORITY;\n    }\n\n    return RendererConfig_1.RenderingPreference.INVALID;\n  },\n  render: exports.VideoRenderer\n};","map":{"version":3,"sources":["/Users/derekbrown/workspace/10kdigits/node_modules/@zoralabs/nft-components/dist/content-components/Video.js"],"names":["Object","defineProperty","exports","value","Video","VideoRenderer","jsx_runtime_1","require","react_1","MediaLoader_1","RendererConfig_1","Image_1","useSyncRef_1","useA11yIdPrefix_1","forwardRef","props","ref","_a","_b","_c","_d","getString","getStyles","request","theme","a11yIdPrefix","isPlaying","setIsPlaying","useState","isMuted","setIsMuted","isFullScreen","setIsFullScreen","video","useRef","controlAriaId","useA11yIdPrefix","uri","renderingContext","media","animation","content","mediaProps","loading","error","useMediaObjectProps","preferredIPFSGateway","useSyncRef","useEffect","fullScreenCallback","document","fullscreenElement","addEventListener","removeEventListener","togglePlay","useCallback","current","paused","play","pause","openFullscreen","elem","requestFullscreen","webkitSetPresentationMode","onCanPlay","toggleMute","muted","playLoop","currentTime","playingText","jsx","ImageRenderer","assign","jsxs","MediaLoader","children","id","tabIndex","onMouseOut","evt","target","blur","undefined","isFullPage","onClick","title","playing","autoPlay","controls","loop","onCanPlayThrough","onEnded","onLoadedData","onLoad","onPause","onPlay","playsInline","preload","getRenderingPreference","type","startsWith","RenderingPreference","PRIORITY","INVALID","render"],"mappings":"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","sourcesContent":["\"use strict\";\nObject.defineProperty(exports, \"__esModule\", { value: true });\nexports.Video = exports.VideoRenderer = void 0;\nconst jsx_runtime_1 = require(\"react/jsx-runtime\");\nconst react_1 = require(\"react\");\nconst MediaLoader_1 = require(\"./MediaLoader\");\nconst RendererConfig_1 = require(\"./RendererConfig\");\nconst Image_1 = require(\"./Image\");\nconst useSyncRef_1 = require(\"../utils/useSyncRef\");\nconst useA11yIdPrefix_1 = require(\"../utils/useA11yIdPrefix\");\nexports.VideoRenderer = react_1.forwardRef((props, ref) => {\n    var _a, _b, _c, _d;\n    const { getString, getStyles, request, theme, a11yIdPrefix } = props;\n    const [isPlaying, setIsPlaying] = react_1.useState(true);\n    const [isMuted, setIsMuted] = react_1.useState(true);\n    const [isFullScreen, setIsFullScreen] = react_1.useState(false);\n    const video = react_1.useRef(null);\n    const controlAriaId = useA11yIdPrefix_1.useA11yIdPrefix(\"video-renderer\");\n    const uri = request.renderingContext === \"FULL\"\n        ? ((_a = request.media.animation) === null || _a === void 0 ? void 0 : _a.uri) || ((_b = request.media.content) === null || _b === void 0 ? void 0 : _b.uri)\n        : ((_c = request.media.content) === null || _c === void 0 ? void 0 : _c.uri) || ((_d = request.media.animation) === null || _d === void 0 ? void 0 : _d.uri);\n    const { props: mediaProps, loading, error, } = MediaLoader_1.useMediaObjectProps({\n        uri,\n        request,\n        a11yIdPrefix,\n        getStyles,\n        preferredIPFSGateway: theme.preferredIPFSGateway,\n    });\n    useSyncRef_1.useSyncRef(video, ref);\n    react_1.useEffect(() => {\n        const fullScreenCallback = () => {\n            setIsFullScreen(!!document.fullscreenElement);\n        };\n        document.addEventListener(\"fullscreenchange\", fullScreenCallback);\n        return () => {\n            document.removeEventListener(\"fullscreenchange\", fullScreenCallback);\n        };\n    }, []);\n    const togglePlay = react_1.useCallback(() => {\n        var _a;\n        if (!video.current) {\n            return;\n        }\n        if (video.current.paused) {\n            video.current.play();\n        }\n        else {\n            (_a = video.current) === null || _a === void 0 ? void 0 : _a.pause();\n        }\n    }, [video]);\n    const openFullscreen = react_1.useCallback(() => {\n        const elem = video.current;\n        if (elem && elem.requestFullscreen) {\n            setIsMuted(false);\n            return elem.requestFullscreen();\n        }\n        // Thank Apple for this one :(. Needed for iOS\n        // @ts-ignore\n        if (elem && elem.webkitSetPresentationMode) {\n            setIsMuted(false);\n            // @ts-ignore\n            return elem.webkitSetPresentationMode(\"fullscreen\");\n        }\n        return;\n    }, [video]);\n    const onCanPlay = react_1.useCallback(() => {\n        var _a;\n        setIsPlaying(!((_a = video.current) === null || _a === void 0 ? void 0 : _a.paused));\n    }, []);\n    const toggleMute = react_1.useCallback(() => {\n        if (!video.current) {\n            return;\n        }\n        if (video.current.muted) {\n            setIsMuted(false);\n        }\n        else {\n            setIsMuted(true);\n        }\n    }, [video]);\n    const playLoop = react_1.useCallback(() => {\n        if (!video.current) {\n            return;\n        }\n        video.current.currentTime = 0;\n    }, [video.current]);\n    const playingText = isPlaying\n        ? getString(\"VIDEO_CONTROLS_PAUSE\")\n        : getString(\"VIDEO_CONTROLS_PLAY\");\n    // Fallback to rendering an image if loading the video fails\n    if (error) {\n        return jsx_runtime_1.jsx(Image_1.ImageRenderer, Object.assign({}, props), void 0);\n    }\n    return (jsx_runtime_1.jsxs(MediaLoader_1.MediaLoader, Object.assign({ getStyles: getStyles, loading: loading, error: error }, { children: [video.current && (jsx_runtime_1.jsxs(\"div\", Object.assign({ \"aria-label\": getString(\"VIDEO_CONTROLS_LABEL\"), id: controlAriaId, tabIndex: \"0\", \n                // @ts-ignore Blur is kinda invalid but okay to be unsafe here.\n                onMouseOut: (evt) => evt.target.blur() }, getStyles(\"mediaVideoControls\", undefined, {\n                isFullPage: request.renderingContext === \"FULL\",\n            }), { children: [jsx_runtime_1.jsx(\"button\", Object.assign({}, getStyles(\"mediaFullscreenButton\"), { \"aria-pressed\": isFullScreen ? true : false, onClick: openFullscreen, title: getString(\"VIDEO_CONTROLS_FULLSCREEN\") }, { children: getString(\"VIDEO_CONTROLS_FULLSCREEN\") }), void 0),\n                    jsx_runtime_1.jsx(\"button\", Object.assign({}, getStyles(\"mediaPlayButton\", undefined, {\n                        playing: isPlaying,\n                    }), { \"aria-live\": \"polite\", \"aria-pressed\": isPlaying ? false : true, onClick: togglePlay, title: playingText }, { children: playingText }), void 0),\n                    jsx_runtime_1.jsx(\"button\", Object.assign({}, getStyles(\"mediaMuteButton\", undefined, { muted: isMuted }), { onClick: toggleMute, \"aria-pressed\": isMuted ? false : true }, { children: getString(\"VIDEO_CONTROLS_MUTE\") }), void 0)] }), void 0)),\n            jsx_runtime_1.jsx(\"video\", Object.assign({}, mediaProps, { \"aria-controls\": controlAriaId, autoPlay: true, controls: isFullScreen, loop: true, muted: isMuted, onCanPlayThrough: onCanPlay, onEnded: playLoop, onLoadedData: mediaProps.onLoad, onPause: () => setIsPlaying(false), onPlay: () => setIsPlaying(true), playsInline: true, preload: \"metadata\", ref: video }), void 0)] }), void 0));\n});\nexports.Video = {\n    getRenderingPreference: (request) => {\n        var _a, _b, _c, _d;\n        if ((_b = (_a = request.media.animation) === null || _a === void 0 ? void 0 : _a.type) === null || _b === void 0 ? void 0 : _b.startsWith(\"video/\")) {\n            return RendererConfig_1.RenderingPreference.PRIORITY;\n        }\n        if ((_d = (_c = request.media.content) === null || _c === void 0 ? void 0 : _c.type) === null || _d === void 0 ? void 0 : _d.startsWith(\"video/\")) {\n            return RendererConfig_1.RenderingPreference.PRIORITY;\n        }\n        return RendererConfig_1.RenderingPreference.INVALID;\n    },\n    render: exports.VideoRenderer,\n};\n"]},"metadata":{},"sourceType":"script"}