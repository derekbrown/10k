import e,{createContext as t,useContext as n,useMemo as r,useCallback as o}from"react";import a,{SWRConfig as i,useSWRConfig as s}from"swr";function c(){return c=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e},c.apply(this,arguments)}const u=/^https:\/\/rarible\.com\/token\/(0x[a-fA-F0-9]{40}):([0-9]+)/;function l(e){return/^0x[a-fA-F0-9]{40}$/.test(e)}function d(e){return e}function f(e){const t=u.exec(e);return t?[t[1],t[2]]:null}function h(e,t=""){return`https://ipfs.io/ipfs/${e}${t}`}const m=/^ipfs:\/\/(?:ipfs\/)?([^/]+)(\/.+)?$/,p=/^Qm[1-9A-HJ-NP-Za-km-z]{44}$/;function g(e,t){const n=m.exec(e);if(n){const[,e,r=""]=n;return t(e,r)}return p.test(e)?t(e):e}function w(e,t,n){return e=function(e,t){try{const n=new URL(e);return"api.opensea.io"!==n.host&&"testnets-api.opensea.io"!==n.host||!n.pathname.includes("0x%7Bid%7D")?e:(n.pathname=n.pathname.replace(/0x%7Bid%7D/g,t),n.searchParams.set("format","json"),String(n))}catch(t){return e}}(e,t),(e=g(e=function(e){try{const t=new URL(e);return"api.niftygateway.com"!==t.host?e:(t.pathname=t.pathname+"/",String(t))}catch(t){return e}}(e),n.ipfsUrl)).startsWith("http")&&(e=n.jsonProxy(e)),e}function y(e,t){return g(e,t.ipfsUrl)}function v(e,t){return(null==e?void 0:e.toLowerCase())===(null==t?void 0:t.toLowerCase())}function x(e){return b(Promise.all([...e].map(b)))}function b(e){return new Promise((t,n)=>{Promise.resolve(e).then(n,t)})}class I extends Error{constructor(e,t){super(e),this.errors=void 0,this.name="MultipleErrors",this.errors=t}}const k=/\.(?:png|svg|jpg|jepg|gif|webp|jxl|avif)$/,P=/\.(?:mp4|mov|webm|ogv)$/;function A(e){return k.test(e)?"image":P.test(e)?"video":"unknown"}const E={address:"0x16F5A35647D6F03D5D3da7b35409D65ba03aF3B2",methodName:"punkImageSvg",methodHash:"0x74beb047",humanReadableAbi:["function punkImageSvg(uint16 index) view returns (string svg)"]};function U(e){var t;const n=e.indexOf(",")+1;return null!=(t=e.slice(0,n)+encodeURIComponent(e.slice(n)))?t:""}async function j(e,t){return{description:'\n  10,000 unique collectible characters with proof of ownership stored on the\n  Ethereum blockchain. The project that inspired the modern CryptoArt movement.\n  The first "Non-Fungible Token," and inspiration for the Ethereum ERC-721\n  standard that powers most digital art and collectibles.\n',image:U(await t(e,E)),imageType:"image",metadataUrl:"",name:`CryptoPunk ${e}`,owner:"",rawData:null}}function D(e){return v(e,"0xb47e3cd837ddf8e4c57f05d70ab865de6e193bbb")}async function T(e,{jsonProxy:t}){var n,r,o;const a=t(`https://api.cryptokitties.co/v3/kitties/${e}`),i=await fetch(a),s=await i.json(),c=null!=(n=null==s?void 0:s.image_url)?n:"";return{description:null!=(r=null==s?void 0:s.bio)?r:"−",image:c,imageType:c?"image":"unknown",metadataUrl:a,name:null!=(o=null==s?void 0:s.name)?o:"Unknown",owner:"",rawData:s}}function $(e){return v(e,"0x06012c8cf97BEaD5deAe237070F9587f8E7A266d")}function F(e,t){return JSON.stringify({operationName:"NFTByTokenId",variables:{contractAddress:e,tokenId:t},query:"\n  query NFTByTokenId($contractAddress: String, $tokenId: String) {\n    nfts(\n      where: { contractAddress: $contractAddress, tokenId: $tokenId }\n      first: 1\n    ) {\n      name\n      image\n      owner {\n        address\n      }\n      estate {\n        size\n        data {\n          description\n        }\n      }\n    }\n  }\n"})}async function N(e){var t,n,r,o,a,i,s,c;const u=await fetch("https://api.thegraph.com/subgraphs/name/decentraland/marketplace",{body:F("0x959e104E1a4dB6317fA58F8295F586e1A978c297",e),method:"POST"}),{data:l}=await u.json(),d=null==l||null==(t=l.nfts)?void 0:t[0],f=null!=(n=null==d?void 0:d.image)?n:"";return{description:null!=(r=null==d||null==(o=d.estate)||null==(a=o.data)?void 0:a.description)?r:"−",image:f,imageType:f?"image":"unknown",metadataUrl:"",name:null!=(i=null==d?void 0:d.name)?i:"Unknown",owner:null!=(s=null==d||null==(c=d.owner)?void 0:c.address)?s:"",rawData:l}}function B(e){return v(e,"0x959e104E1a4dB6317fA58F8295F586e1A978c297")}function C(e,t){return JSON.stringify({operationName:"NFTByTokenId",variables:{contractAddress:e,tokenId:t},query:"\n  query NFTByTokenId($contractAddress: String, $tokenId: String) {\n    nfts(\n      where: { contractAddress: $contractAddress, tokenId: $tokenId }\n      first: 1\n    ) {\n      name\n      image\n      owner {\n        address\n      }\n      parcel {\n        x\n        y\n        data {\n          description\n        }\n      }\n    }\n  }\n"})}async function S(e){var t,n,r,o,a,i,s;const c=await fetch("https://api.thegraph.com/subgraphs/name/decentraland/marketplace",{body:C("0xf87e31492faf9a91b02ee0deaad50d51d56d5d4d",e),method:"POST"}),{data:u}=await c.json(),l=null==u||null==(t=u.nfts)?void 0:t[0],d=null==l?void 0:l.parcel,f=null!=(n=null==l?void 0:l.image)?n:"";return{description:null!=(r=null==d||null==(o=d.data)?void 0:o.description)?r:"-",image:f,imageType:f?"image":"unknown",metadataUrl:"",name:null!=(a=null==l?void 0:l.name)?a:`Parcel ${null==d?void 0:d.x},${null==d?void 0:d.y}`,owner:null!=(i=null==l||null==(s=l.owner)?void 0:s.address)?i:"",rawData:u}}function O(e){return v(e,"0xf87e31492faf9a91b02ee0deaad50d51d56d5d4d")}const R={address:"0x7c40c393dc0f283f318791d746d894ddd3693572",methodName:"_tokenIDToCatID",methodHash:"0xfe294644",humanReadableAbi:["function _tokenIDToCatID(uint256 tokenId) view returns (bytes5 catId)"]};async function q(e,t,n){var r;const o=await t(e,R),a=null!=(r=await async function(e,t){const n=g(`ipfs://ipfs/bafybeidk4zunuq56w2pf2sncexohlyqae62dzplljkbwswa7jwywh2dava/${e.slice(4,6)}/${e}.png`,t);var r;return function(e,{scale:t=1,padding:n=0}={}){const r=e.naturalWidth*t,o=e.naturalHeight*t,a=Math.max(r*n,o*n),i=document.createElement("canvas");i.width=r+2*a,i.height=o+2*a;const s=i.getContext("2d");return null===s?null:(s.imageSmoothingEnabled=!1,s.drawImage(e,a,a,r,o),i.toDataURL())}(await(r=n,new Promise((e,t)=>{const n=new Image;n.src=r,n.crossOrigin="",n.onload=()=>e(n),n.onerror=e=>t(e)})),{scale:4,padding:.125})}(o,n.ipfsUrl))?r:"";return{description:`The (unofficial) wrapped version of MoonCats Rescue. Original cat ID: ${o}.`,image:a,imageType:a?"image":"unknown",metadataUrl:"",name:`Wrapped MoonCat #${e}`,owner:"",rawData:null}}function M(e){return v(e,R.address)}async function _(e,t){const n=await fetch(e);if(!n.ok)throw new Error("Error when trying to request "+e);let r;try{r=await n.json()}catch(t){r={name:"",description:"",image:e}}let o=c({},r);if(function(e){var t,n,r,o,a,i,s,c,u,l,d,f;return!(!e||"object"!=typeof e)&&"Asset Metadata"===e.title&&"object"===e.type&&"string"==typeof(null==(t=e.properties)||null==(n=t.name)?void 0:n.description)&&"string"==typeof(null==(r=e.properties)||null==(o=r.image)?void 0:o.description)&&"string"==typeof(null==(a=e.properties)||null==(i=a.description)?void 0:i.description)&&"string"===(null==(s=e.properties)||null==(c=s.name)?void 0:c.type)&&"string"===(null==(u=e.properties)||null==(l=u.image)?void 0:l.type)&&"string"===(null==(d=e.properties)||null==(f=d.description)?void 0:f.type)}(o)&&(o=function(e){var t,n,r,o,a,i;return{name:(null==(t=e.properties)||null==(n=t.name)?void 0:n.description)||"",description:(null==(r=e.properties)||null==(o=r.description)?void 0:o.description)||"",image:(null==(a=e.properties)||null==(i=a.image)?void 0:i.description)||"",rawData:c({},e)}}(o)),o=function(e){return e&&"object"==typeof e&&void 0===(null==e?void 0:e.image)&&"string"==typeof(null==e?void 0:e.imageUrl)?c({},e,{image:null==e?void 0:e.imageUrl}):e}(o),!function(e){return!(!e||"object"!=typeof e)&&("name"in e||"image"in e)}(o))throw new Error("Invalid data received");return function(e,t){return c({},e,{image:y(e.image,t)})}({description:o.description||"",image:o.image||"",name:o.name||"",rawData:r},t)}const z=["function tokenURI(uint256 _tokenId) external view returns (string)","function ownerOf(uint256 _tokenId) external view returns (address)","function uri(uint256 _id) external view returns (string)"];async function H(e,t,n){return w(await x([e.tokenURI(t),e.uri(t)]).catch(e=>{throw new I("An error occurred while trying to fetch the token URI from the NFT contract. See the “errors” property on this error for details.",e)}),t,n)}function L(e){return{config:e,async fetchNft(t,n,r){if(!l(t))throw new Error(`Invalid contract address: ${t}`);return o=await async function(e,t,n,r){if(O(e))return S(t);if(B(e))return N(t);if($(e))return T(t,r);const o=await async function(e){var t;if(null!=(t=e.ethers)&&t.Contract)return e;try{const t=await import("@ethersproject/contracts");if(null==t||!t.Contract)throw new Error;return c({},e,{ethers:t})}catch(e){throw new Error("Ethers couldn’t be imported. Please add the ethers module to your project dependencies, or inject it in the Ethers fetcher options.")}}(n);return D(e)?j(t,function(e){return async function(t,n){return new e.ethers.Contract(n.address,n.humanReadableAbi,e.provider).punkImageSvg(t)}}(o)):M(e)?q(t,function(e){return async function(t,n){const r=new e.ethers.Contract(n.address,n.humanReadableAbi,e.provider),o=await r._tokenIDToCatID(t);return null!=o?o:""}}(o),r):async function(e,t,n,r){const o=new n.ethers.Contract(e,z,n.provider),[a,i]=await Promise.all([H(o,t,r),o.ownerOf(t).catch(()=>"")]),s=await _(a,r);return c({},s,{imageType:A(s.image),metadataUrl:a,owner:i})}(e,t,o,r)}(t,n,e,r),a=r.imageProxy,o.image.startsWith("http")?c({},o,{image:a(o.image,o)}):o;var o,a}}}function W(e){let t="";for(let n=0;n<32;++n)t+=("0"+(e>>BigInt(256-8*n-8)&BigInt(255)).toString(16)).slice(-2);return t}function J(e){let t=BigInt(0);for(const n of e)t=(t<<BigInt(8))+BigInt(n);return t}function Q(e){var t;return e=e.replace(/^0x/,""),new Uint8Array((null!=(t=e.match(/.{1,2}/g))?t:[]).map(e=>parseInt(e,16)))}function Z(e){const t=Q(e),n=Number(J(t.subarray(0,32))),r=Number(J(t.subarray(n,n+32))),o=t.subarray(n+32,n+32+r);return(new TextDecoder).decode(o)}function G(e){const t=J(Q(e).subarray(0,32));if(t>=BigInt(2)**BigInt(160))throw new Error(`Encoded value is bigger than the largest possible address.  Decoded value: 0x${t.toString(16)}.`);return`0x${t.toString(16)}`}function K(e){return"0xc87b56dd"+W(e)}function V(e){return"0x6352211e"+W(e)}function X(e,t,n){return e.request({method:"eth_call",params:[{data:n,to:t},"latest"]})}async function Y(e,t,n,r){const o=await x(function(e){return[K(BigInt(e)),(t=BigInt(e),"0x0e89341c"+W(t))];var t}(t).map(t=>X(n,e,t))).catch(e=>{throw new I("An error occurred while trying to fetch the token URI from the NFT contract. See the “errors” property on this error for details.",e)});return w(Z(o),t,r)}function ee(e){const t=function(e){if(!e.ethereum){if(!window.ethereum)throw new Error("Missing ethereum provider.");e.ethereum=window.ethereum}return e}(e);return{config:t,async fetchNft(e,n,r){if(!l(e))throw new Error(`Invalid contract address: ${e}`);return o=await async function(e,t,n,r){return O(e)?S(t):B(e)?N(t):$(e)?T(t,r):D(e)?j(t,function(e){return async function(t,n){if(void 0===e.ethereum)throw new Error("No Ethereum provider");return X(e.ethereum,n.address,n.methodHash+W(BigInt(t))).then(Z)}}(n)):M(e)?q(t,function(e){return async function(t,n){if(void 0===e.ethereum)throw new Error("No Ethereum provider");return(await X(e.ethereum,n.address,n.methodHash+W(BigInt(t)))).slice(0,12)}}(n),r):async function(e,t,{ethereum:n},r){const[o,a]=await Promise.all([Y(e,t,n,r),X(n,e,V(BigInt(t))).then(G).catch(()=>"")]),i=await _(o,r);return c({},i,{imageType:A(i.image),metadataUrl:o,owner:a})}(e,t,n,r)}(e,n,t,r),a=r.imageProxy,o.image.startsWith("http")?c({},o,{image:a(o.image,o)}):o;var o,a}}}const te={name:"",description:"",image:""};function ne(e){return function(e){return Array.isArray(e)&&2==e.length&&"ethers"===e[0]}(e)?L(e[1]):function(e){return Array.isArray(e)&&2==e.length&&"ethereum"===e[0]}(e)?ee(e[1]):e}const re=t(null),oe=function({children:t,fetcher:n,imageProxy:r=d,ipfsUrl:o=h,jsonProxy:a=d}){if(!n)throw new Error("Please set the fetcher prop on <NftProvider />");const s={fetcher:ne(n),imageProxy:r,ipfsUrl:o,jsonProxy:a};return e.createElement(i,{value:{provider:()=>new Map}},e.createElement(re.Provider,{value:s},t))};function ae(e,t){var i;const u=n(re);if(null===u)throw new Error("Please wrap your app with <NftProvider />");const{fetcher:l,imageProxy:d,ipfsUrl:f,jsonProxy:h}=u,m=r(()=>({imageProxy:d,ipfsUrl:f,jsonProxy:h}),[d,f,h]),p=o(()=>l?l.fetchNft(e,t,m):c({},te),[e,l,m,t]),{cache:g}=s(),w=null!=(i=g.get(e+t))&&i,y=a(e+t,p,{revalidateOnMount:!w,revalidateOnFocus:!1,revalidateOnReconnect:!1});return r(()=>{const{error:e,data:t,mutate:n}=y,r=()=>n().then(()=>!0).catch(()=>!1);return void 0===e&&void 0===t?{error:void 0,loading:!0,nft:void 0,reload:r,status:"loading"}:void 0!==e?{error:e,loading:!1,nft:void 0,reload:r,status:"error"}:{error:void 0,loading:!1,nft:t,reload:r,status:"done"}},[y])}const ie={name:"",description:"",image:""};class se{constructor(e,t={}){this.fetcher=void 0,this.fetchContext=void 0,this.fetcher=this.normalizeFetcher(e),this.fetchContext=this.fetchContextFromOptions(t)}fetchContextFromOptions({imageProxy:e,ipfsUrl:t,jsonProxy:n}){return{imageProxy:null!=e?e:d,ipfsUrl:null!=t?t:h,jsonProxy:null!=n?n:d}}normalizeFetcher(e){return e?this.isFetcherDeclarationEthers(e)?L(e[1]):this.isFetcherDeclarationEthereum(e)?ee(e[1]):e:{config:{},fetchNft:()=>Promise.resolve(ie)}}isFetcherDeclarationEthers(e){return Array.isArray(e)&&2==e.length&&"ethers"===e[0]}isFetcherDeclarationEthereum(e){return Array.isArray(e)&&2==e.length&&"ethereum"===e[0]}async fetchNft(e,t){return await this.fetcher.fetchNft(e,t,this.fetchContext)}}export{se as FetchWrapper,oe as NftProvider,ee as ethereumFetcher,L as ethersFetcher,f as parseNftUrl,ae as useNft};
//# sourceMappingURL=use-nft.modern.js.map
